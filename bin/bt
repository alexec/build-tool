#!/bin/sh
set -Eeuo pipefail

unset JAVA_TOOL_OPTIONS

export M2_REPO=$HOME/.m2/repository

version=${version:-1.0.10-SNAPSHOT}

echo $version

export CLASSPATH=$M2_REPO/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:$M2_REPO/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar:$M2_REPO/ch/qos/logback/logback-core/1.2.3/logback-core-1.2.3.jar:$M2_REPO/com/google/googlejavaformat/google-java-format/1.6/google-java-format-1.6.jar:$M2_REPO/com/google/guava/guava/22.0/guava-22.0.jar:$M2_REPO/com/google/code/findbugs/jsr305/1.3.9/jsr305-1.3.9.jar:$M2_REPO/com/google/errorprone/error_prone_annotations/2.0.18/error_prone_annotations-2.0.18.jar:$M2_REPO/com/google/j2objc/j2objc-annotations/1.1/j2objc-annotations-1.1.jar:$M2_REPO/org/codehaus/mojo/animal-sniffer-annotations/1.14/animal-sniffer-annotations-1.14.jar:$M2_REPO/com/google/errorprone/javac-shaded/9+181-r4173-1/javac-shaded-9+181-r4173-1.jar:$M2_REPO/com/puppycrawl/tools/checkstyle/8.12/checkstyle-8.12.jar:$M2_REPO/antlr/antlr/2.7.7/antlr-2.7.7.jar:$M2_REPO/org/antlr/antlr4-runtime/4.7.1/antlr4-runtime-4.7.1.jar:$M2_REPO/commons-beanutils/commons-beanutils/1.9.3/commons-beanutils-1.9.3.jar:$M2_REPO/commons-logging/commons-logging/1.2/commons-logging-1.2.jar:$M2_REPO/commons-collections/commons-collections/3.2.2/commons-collections-3.2.2.jar:$M2_REPO/commons-cli/commons-cli/1.4/commons-cli-1.4.jar:$M2_REPO/net/sf/saxon/Saxon-HE/9.8.0-12/Saxon-HE-9.8.0-12.jar:$M2_REPO/com/fasterxml/jackson/core/jackson-databind/2.9.4/jackson-databind-2.9.4.jar:$M2_REPO/com/fasterxml/jackson/core/jackson-annotations/2.9.0/jackson-annotations-2.9.0.jar:$M2_REPO/com/fasterxml/jackson/core/jackson-core/2.9.4/jackson-core-2.9.4.jar:$M2_REPO/javax/inject/javax.inject/1/javax.inject-1.jar:$M2_REPO/junit/junit/4.12/junit-4.12.jar:$M2_REPO/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar

for jar in $(echo $CLASSPATH | tr ':' "\n") ; do
  if [ ! -e $jar ]; then
    path=$(echo $jar | sed 's/.*repository\///')
    url="http://central.maven.org/maven2/$path"
    mkdir -p $(dirname $jar)
    curl -fq $url -o $jar
  fi
done

lib=$(dirname $0)/../lib/main-$version.jar

if [ -e $lib ]; then
  export CLASSPATH=$(dirname $0)/../lib/api-$version.jar:$(dirname $0)/../lib/main-$version.jar:$CLASSPATH
else
  export CLASSPATH=$M2_REPO/bt/api/$version/api-$version.jar:$M2_REPO/bt/main/$version/main-$version.jar:$CLASSPATH
fi

java bt.Main $*
